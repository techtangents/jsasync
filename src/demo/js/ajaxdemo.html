<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script type="text/javascript" src="../../../lib/test/jquery-1.6.2.js"></script>
    <script type="text/javascript" src="../../../lib/run/javascriptcore.js"></script>
    <script type="text/javascript" src="../../../src/main/js/jsasync.js"></script>

    <script type="text/javascript">
        function go() {
            var ajax = techtangents.jsasync.api.auto.Jquery.ajax;
            var Either = techtangents.jsasync.util.Either;
            var Util = techtangents.jsasync.util.Util;

            var getDataProperty = function(jqSuccessObject) {
                return jqSuccessObject.data;
            };

            var addStuff = function(x) {
                return "some stuff: " + x;
            };

            // ------------------------------------------------------------------------------------
            // all of these pass, resulting in: ["some stuff: text 1", "some stuff: text 2"]
            var passUrls = ["text1.txt", "text2.txt"];
            ajax.map(getDataProperty).map(addStuff).amap(passUrls)(console.log, console.log);


            // ------------------------------------------------------------------------------------
            // some of these fail, so we get an array of Eithers logged
            var mixedUrls = ["text1.txt", "notfound.txt", "text2.txt"];
            var runMixed = ajax.map(getDataProperty).map(addStuff).amap(mixedUrls);
            runMixed(console.log, console.log);


            // ------------------------------------------------------------------------------------
            // this gets all of the passing ones above:
            runMixed.mapFail(Either.goods)(console.log, console.log);


            // ------------------------------------------------------------------------------------
            // this gets all of the failing ones above:
            runMixed.mapFail(Either.bads)(console.log, console.log);
        

            // ------------------------------------------------------------------------------------
            // this gets the error codes of the failing ones:
            var getErrorCode = function(jqFailObject) {
                return jqFailObject.jqXHR.status;
            };
            var getErrorCodes = function(failArray) {
                return Util.arrayMap(failArray, getErrorCode);
            };
            runMixed.mapFail(Either.bads).mapFail(getErrorCodes)(console.log, console.log);
                    
        };

    </script>
</head>
<body>
    <button type="button" onclick="go();">go!</button>
</body>
</html>